<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hot Works Permit</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #f2f2f2;
  margin: 0;
  padding: 12px;
}

h1 {
  text-align: center;
  margin-bottom: 10px;
}

.section {
  background: #fff;
  padding: 14px;
  margin-bottom: 14px;
  border-radius: 10px;
}

label {
  font-weight: 600;
  display: block;
  margin-top: 10px;
}

input, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 16px;
}

textarea {
  min-height: 120px;
}

canvas {
  width: 100%;
  height: 180px;
  border: 2px dashed #888;
  border-radius: 6px;
  touch-action: none;
}

.sig-buttons {
  display: flex;
  gap: 10px;
  margin-top: 8px;
}

button {
  flex: 1;
  padding: 10px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  background: #e0e0e0;
}

.photo {
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>Hot Works Permit</h1>

<div class="section">
  <label>Job Location</label>
  <input type="text">

  <label>Date</label>
  <input type="date">

  <label>Start Time</label>
  <input type="time">

  <label>Finish Time</label>
  <input type="time">
</div>

<div class="section">
  <label>Work Description</label>
  <textarea placeholder="Describe the hot works in detail..."></textarea>
</div>

<div class="section">
  <label>Fire Watcher Name</label>
  <input type="text">

  <label>Fire Watcher Signature</label>
  <canvas id="sigFire"></canvas>
  <div class="sig-buttons">
    <button onclick="undo('fire')">Undo</button>
    <button onclick="clearSig('fire')">Clear</button>
  </div>

  <p>Fire watch must remain 30 minutes post works.</p>
</div>

<div class="section">
  <label>Contractor Name</label>
  <input type="text">

  <label>Contractor Signature</label>
  <canvas id="sigContractor"></canvas>
  <div class="sig-buttons">
    <button onclick="undo('contractor')">Undo</button>
    <button onclick="clearSig('contractor')">Clear</button>
  </div>
</div>

<div class="section">
  <label>Before Work Photo</label>
  <input class="photo" type="file" accept="image/*" capture="environment">

  <label>After Work Photo</label>
  <input class="photo" type="file" accept="image/*" capture="environment">
</div>

<script>
function setupSignature(canvasId) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;

  let drawing = false;
  let strokes = [];
  let currentStroke = [];

  function redraw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    strokes.forEach(stroke => {
      ctx.beginPath();
      stroke.forEach((p, i) => {
        if (i === 0) ctx.moveTo(p.x, p.y);
        else ctx.lineTo(p.x, p.y);
      });
      ctx.stroke();
    });
  }

  function getPos(e) {
    const r = canvas.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return { x: t.clientX - r.left, y: t.clientY - r.top };
  }

  canvas.addEventListener("mousedown", e => {
    drawing = true;
    currentStroke = [getPos(e)];
  });

  canvas.addEventListener("touchstart", e => {
    drawing = true;
    currentStroke = [getPos(e)];
  });

  canvas.addEventListener("mousemove", e => {
    if (!drawing) return;
    currentStroke.push(getPos(e));
    redrawTemp();
  });

  canvas.addEventListener("touchmove", e => {
    if (!drawing) return;
    currentStroke.push(getPos(e));
    redrawTemp();
  });

  function redrawTemp() {
    redraw();
    ctx.beginPath();
    currentStroke.forEach((p, i) => {
      if (i === 0) ctx.moveTo(p.x, p.y);
      else ctx.lineTo(p.x, p.y);
    });
    ctx.stroke();
  }

  function endStroke() {
    if (drawing && currentStroke.length) strokes.push(currentStroke);
    drawing = false;
  }

  canvas.addEventListener("mouseup", endStroke);
  canvas.addEventListener("mouseleave", endStroke);
  canvas.addEventListener("touchend", endStroke);

  return {
    undo() { strokes.pop(); redraw(); },
    clear() { strokes = []; redraw(); }
  };
}

const fireSig = setupSignature("sigFire");
const contractorSig = setupSignature("sigContractor");

function undo(type) {
  type === "fire" ? fireSig.undo() : contractorSig.undo();
}

function clearSig(type) {
  type === "fire" ? fireSig.clear() : contractorSig.clear();
}
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hot Works Permit</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,sans-serif;
  background:#eef1f4;
  margin:0;
  padding:12px
}
h1{margin-bottom:4px}
h2{
  margin:0 0 10px 0;
  font-size:18px;
  border-bottom:1px solid #ddd;
  padding-bottom:4px
}
.section{
  background:#fff;
  padding:14px;
  margin-bottom:14px;
  border-radius:12px;
  box-shadow:0 1px 4px rgba(0,0,0,.08)
}
label{
  display:block;
  margin-top:10px;
  font-weight:600
}
input,textarea{
  width:100%;
  padding:10px;
  margin-top:5px;
  font-size:16px;
  border-radius:8px;
  border:1px solid #ccc
}
textarea{min-height:140px}
.checks label{
  font-weight:400;
  margin-top:6px
}
canvas{
  width:100%;
  height:160px;
  border:1px solid #aaa;
  border-radius:8px;
  background:#fff;
  margin-top:6px
}
button{
  margin-top:10px;
  padding:12px;
  font-size:16px;
  width:100%;
  border-radius:10px;
  border:none;
  background:#222;
  color:#fff
}
.photo-preview img{
  max-width:100%;
  margin-top:8px;
  border-radius:8px
}
.locked{
  pointer-events:none;
  opacity:.6
}
@media print{
  button{display:none}
}
</style>
</head>

<body>

<h1>Hot Works Permit</h1>
<p style="font-size:13px;margin-top:0">
Complies with AS 1674.1, AS 1940 and Australian WHS requirements
</p>

<div class="section">
<label>Date</label>
<input type="date" id="date">

<label>Site / Location</label>
<input id="site">

<label>Company / Contractor</label>
<input id="company">
</div>

<div class="section checks">
<h2>Type of Hot Work</h2>

<label><input type="checkbox"> Welding</label>
<label><input type="checkbox"> Cutting</label>
<label><input type="checkbox"> Grinding</label>
<label><input type="checkbox"> Oxy / LPG Heating</label>
<label><input type="checkbox"> Brazing / Soldering</label>
<label><input type="checkbox"> Torch / Heat Gun</label>

<label style="margin-top:12px">Other Hot Work (describe)</label>
<textarea id="hotOther"></textarea>
</div>

<div class="section">
<h2>Description of Works</h2>
<textarea id="description"></textarea>
</div>

<div class="section">
<h2>PPE Required</h2>
<textarea id="ppe"></textarea>
</div>

<div class="section">
<h2>Fire Watch</h2>

<label>Fire Watcher Name</label>
<input id="fireName">

<label>Fire Watch Signature</label>
<canvas id="fireSig"></canvas>
<button onclick="clearSig('fireSig')">Undo Signature</button>

<label>Time Signed</label>
<input type="time" id="fireTime">
</div>

<div class="section">
<h2>Permit Authorisation</h2>

<label>Authorised By</label>
<input id="authName">

<label>Authorising Signature</label>
<canvas id="authSig"></canvas>
<button onclick="clearSig('authSig')">Undo Signature</button>

<label>Time Signed</label>
<input type="time" id="authTime">
</div>

<div class="section">
<h2>Photo Evidence</h2>

<label>Firefighting Equipment in Place</label>
<input type="file" accept="image/*" capture="environment" id="photoFire">
<div class="photo-preview" id="firePreview"></div>

<label>Area Before Hot Works</label>
<input type="file" accept="image/*" capture="environment" id="photoBefore">
<div class="photo-preview" id="beforePreview"></div>

<label>During Hot Works (optional)</label>
<input type="file" accept="image/*" capture="environment" id="photoDuring">
<div class="photo-preview" id="duringPreview"></div>

<label>After Completion</label>
<input type="file" accept="image/*" capture="environment" id="photoAfter">
<div class="photo-preview" id="afterPreview"></div>
</div>

<div class="section">
<button onclick="exportPDF()">Export Permit (PDF)</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
let permitFinalised=false;

function setupSignature(canvas){
  const ctx=canvas.getContext("2d");
  const ratio=window.devicePixelRatio||1;
  canvas.width=canvas.offsetWidth*ratio;
  canvas.height=canvas.offsetHeight*ratio;
  ctx.scale(ratio,ratio);
  ctx.lineWidth=2;
  ctx.lineCap="round";

  let drawing=false;

  function getPos(e){
    const r=canvas.getBoundingClientRect();
    const t=e.touches[0];
    return {x:t.clientX